var e,t,s,i,h,a,r,n,o,l,c,d,u,g,p,m,b,f,y,w,_,v,k,x,L,B,I,S,T,M,P,C,F,D=Object.defineProperty,E=e=>{throw TypeError(e)},O=(e,t,s)=>((e,t,s)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s),W=(e,t,s)=>t.has(e)||E("Cannot "+s),A=(e,t,s)=>(W(e,t,"read from private field"),s?s.call(e):t.get(e)),R=(e,t,s)=>t.has(e)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),H=(e,t,s,i)=>(W(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s);import{p as G,P as N}from"./phaser-t39vChBe.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class j extends G.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg_start.jpg")}create(){this.scene.start("Preloader")}}class K{constructor(e=""){O(this,"seed"),O(this,"rng"),e||(e=this.generateRandomSeedHash()),this.seed=e,console.debug(this.seed),this.rng=new G.Math.RandomDataGenerator([e])}getSeed(){return this.seed}rollADice(e=20){return this.between(1,e)}random(){return this.rng.realInRange(0,1)}between(e,t){return this.rng.integerInRange(e,t)}realBetween(e,t){return this.rng.realInRange(e,t)}generateRandomSeedHash(e=10){const t=crypto.getRandomValues(new Uint8Array(e));return Array.from(t).map((e=>("0"+e.toString(16)).slice(-2))).join("").slice(0,e)}}const U="DynaPuff, serif",V="remplissage_bubble_tea",$="hover",z="interaction",Y="nouveau_record",J="pnj_confus_1",X="pnj_confus_2",q="pnj_heureux_1",Q="pnj_heureux_2",Z="pnj_triste_1",ee="pnj_triste_2",te="aspiration",se="tir",ie="tir_a_blanc",he="contact_tir",ae="sauvetage_pnj_1",re="sauvetage_pnj_2",ne="velo_normal",oe="velo_rapide",le="cinematic_opening",ce="cinematique_de_fin",de="main_menu",ue="theme_credits",ge="theme_principal",pe="button_blue",me="1",be="2",fe="3",ye="4",we="5",_e="bubbletea",ve="cup",ke="cup_cover",xe="cup_full",Le="cup_mask",Be="bike_arm",Ie="bike_wheel",Se="player",Te="player_arm_back",Me="player_hand_back",Pe="player_hand_front",Ce="player_leg_left_down",Fe="player_leg_left_up",De="player_leg_right_down",Ee="player_leg_right_up",Oe="sarbapaille",We="splash",Ae={arbre:"arbre",elementdroit:"elementdroit",elementgauche:"elementgauche",elementmilieu:"elementmilieu",troncD:"troncD",troncG:"troncG"},Re={arbre2_feuillage:"arbre2_feuillage",arbre2:"arbre2",arbre2_tronc:"arbre2_tronc"},He={building_fenetre:"buiding_fenetre",building_fond:"buiding_fond",building:"buiding",building_porte:"buiding_porte"},Ge={building2_facade:"building2_facade",building2_fenetre:"building2_fenetre",building2:"building2",building2_porte:"building2_porte"},Ne={buisson_int:"buisson_int",buisson:"buisson"},je={buisson2_feuillage:"buisson2_feuillage",buisson2:"buisson2"},Ke={chevre_corne:"chevre_corne",chevre_corps:"chevre_corps",chevre_museau:"chevre_museau",chevre_patte:"chevre_patte",chevre:"chevre",chevre_tache1:"chevre_tache1",chevre_tache2:"chevre_tache2",chevre_tache3:"chevre_tache3"},Ue={house_facade:"house_facade",house_fenetre:"house_fenetre",house_mur:"house_mur",house:"house",house_porte:"house_porte",house_toit:"house_toit"},Ve={house2_facade:"house2_facade",house2_fenetre:"house2_fenetre",house2:"house2",house2_porte:"house2_porte",house2_toit:"house2_toit"},$e={house3_facade:"house3_facade",house3_fenetre:"house3_fenetre",house3:"house3",house3_porte:"house3_porte",house3_toit:"house3_toit"},ze={vache_corps:"vache_corps",vache:"vache",vache_tache1:"vache_tache1",vache_tache2:"vache_tache2",vache_tache3:"vache_tache3",vache_tache4:"vache_tache4",vache_tache5:"vache_tache5"},Ye="background_gauge_0",Je="background_gauge_1",Xe="background_gauge_2",qe="background_gauge_3",Qe="background_gauge_4",Ze="timer_background_pink",et="parallax_bg1",tt="parallax_bg2",st="parallax_bg3",it="parallax_bg4",ht="plant1",at="plant2",rt="plant3",nt="road",ot="pnj_heureux_1",lt="pnj_heureux_2",ct="pnj_triste_1",dt="pnj_triste_2";class ut extends G.Scene{constructor(){super("Preloader")}init(){const e=this.add.image(this.scale.width/2,this.scale.height/2,"background");e.setScale(this.scale.width/e.displayWidth);const t=this.add.rectangle(this.scale.width/2,.9*this.scale.height,.8*this.scale.width,.1*this.scale.height).setOrigin(.5).setStrokeStyle(1,16777215).getBounds(),s=this.add.rectangle(t.left+2,t.top+2,t.width-4,t.height-4,16777215).setOrigin(0);this.add.text(0,0,".",{font:'1px "DynaPuff", serif',color:"#000"}).setAlpha(0),this.load.on("progress",(e=>{s.width=4+(t.width-8)*e}))}preload(){this.load.setPath("assets"),this.load.image("bg_end","bg_end.jpg"),this.preloadAudioEffect(),this.preloadAudioMusic(),this.preloadBubbleTea(),this.preloadDecor(),this.preloadHud(),this.preloadParallaxBackground(),this.preloadPlayer(),this.preloadUi(),this.preloadPNJ(),this.preloadIntro()}create(){this.scene.start("Intro")}preloadPlayer(){this.preloadFromListKey([Be,Ie,Se,Te,Me,Pe,Ce,Fe,De,Ee,Oe],"player")}preloadBubbleTea(){this.preloadFromListKey([_e,ve,ke,xe,Le],"bubbletea")}preloadUi(){this.preloadFromListKey([pe],"ui")}preloadHud(){this.preloadFromListKey([Ye,Je,Xe,qe,Qe,Ze],"hud")}preloadDecor(){this.preloadFromListKey([We],"decor"),this.preloadFromListKey([Ae.arbre,Ae.elementdroit,Ae.elementgauche,Ae.elementmilieu,Ae.troncD,Ae.troncG],"decor/arbre"),this.preloadFromListKey([Re.arbre2_feuillage,Re.arbre2,Re.arbre2_tronc],"decor/arbre2"),this.preloadFromListKey([He.building_fenetre,He.building_fond,He.building,He.building_porte],"decor/building"),this.preloadFromListKey([Ge.building2_facade,Ge.building2_fenetre,Ge.building2,Ge.building2_porte],"decor/building2"),this.preloadFromListKey([Ne.buisson_int,Ne.buisson],"decor/buisson1"),this.preloadFromListKey([je.buisson2_feuillage,je.buisson2],"decor/buisson2"),this.preloadFromListKey([Ke.chevre_corne,Ke.chevre_corps,Ke.chevre_museau,Ke.chevre_patte,Ke.chevre,Ke.chevre_tache1,Ke.chevre_tache2,Ke.chevre_tache3],"decor/chevre"),this.preloadFromListKey([Ue.house_facade,Ue.house_fenetre,Ue.house_mur,Ue.house,Ue.house_porte,Ue.house_toit],"decor/house"),this.preloadFromListKey([Ve.house2_facade,Ve.house2_fenetre,Ve.house2,Ve.house2_porte,Ve.house2_toit],"decor/house2"),this.preloadFromListKey([$e.house3_facade,$e.house3_fenetre,$e.house3,$e.house3_porte,$e.house3_toit],"decor/house3"),this.preloadFromListKey([ze.vache_corps,ze.vache,ze.vache_tache1,ze.vache_tache2,ze.vache_tache3,ze.vache_tache4,ze.vache_tache5],"decor/vache")}preloadPNJ(){this.preloadFromListKey([ot,lt,ct,dt],"pnj")}preloadIntro(){this.preloadFromListKey([me,be,fe,ye,we],"intro",".jpg")}preloadFromListKey(e,t,s=".png"){for(const i of e)this.load.image(i,`${t}/${i}${s}`)}preloadParallaxBackground(){this.preloadFromListKey([et,tt,st,it,ht,at,rt,nt],"background")}preloadAudioEffect(){this.preloadAudioFromListKey([V,$,z,Y,J,X,q,Q,Z,ee,te,se,ie,he,ae,re,ne,oe],"effects")}preloadAudioMusic(){this.preloadAudioFromListKey([le,ce,de,ue,ge],"musics")}preloadAudioFromListKey(e,t){for(const s of e)this.load.audio(s,`audio/${t}/${s}.ogg`)}}class gt extends Phaser.GameObjects.Image{constructor(o,l,c,d,u,g){super(o,l,c,d),R(this,e),R(this,t),R(this,s),R(this,i),R(this,h),R(this,a),R(this,r),R(this,n),H(this,t,g),H(this,e,u),H(this,s,new Map),H(this,i,0),H(this,h,!1),H(this,a,d),H(this,r,[]),H(this,n,0),this.setScale(A(this,t)/this.width,A(this,e)/this.height),this.setOrigin(.5,1),this.scene.add.existing(this),this.computePixelOccupationRatio()}isPointInElement(e,t){const s=(e-this.getBounds().left)/this.getBounds().width*this.texture.get().width,i=(t-this.getBounds().top)/this.getBounds().height*this.texture.get().height;return this.scene.textures.getPixelAlpha(s,i,A(this,a),0)>200}receiveBubble(e,t,i,a){if(!A(this,h)){if(A(this,s).set(e,t*t+this.getCurrentSizeByColor(e)),H(this,h,this.checkElementFull()),A(this,h))return this.removeSplashes(),this.setTint(this.getMaxColor()),!0;{const s=this.scene.add.image(i,a,We);s.setScale(t/s.width,t/s.height),s.setTint(e),s.setDepth(this.depth+1),A(this,r).push(s)}}return!1}getCurrentSizeByColor(e){return A(this,s).get(e)||0}checkElementFull(){let e=0;return A(this,s).forEach(((t,s)=>{e+=t})),H(this,i,e),A(this,i)>this.displayWidth*this.displayHeight*A(this,n)}getMaxColor(){let e=0,t=0;return A(this,s).forEach(((s,i)=>{s>e&&(e=s,t=i)})),t}removeSplashes(){A(this,r).forEach((e=>{e.setAlpha(0)}))}computePixelOccupationRatio(){const e=Math.floor(this.texture.get().width/10),t=Math.floor(this.texture.get().height/10);for(let s=0;s<this.texture.get().width;s+=e)for(let e=0;e<this.texture.get().height;e+=t)this.scene.textures.getPixelAlpha(s,e,A(this,a),0)>200&&H(this,n,A(this,n)+.01)}}e=new WeakMap,t=new WeakMap,s=new WeakMap,i=new WeakMap,h=new WeakMap,a=new WeakMap,r=new WeakMap,n=new WeakMap;class pt{constructor(e,t,s,i,h){O(this,"scene"),O(this,"elementList"),O(this,"elementBorder"),O(this,"x"),O(this,"y"),O(this,"height"),O(this,"width"),O(this,"depth"),O(this,"elementFullNb"),O(this,"isFull"),this.scene=e,this.x=t,this.y=s,this.height=i,this.width=h,this.elementFullNb=0,this.isFull=!1,this.createElementList(),this.createElementBorder()}createElementList(){this.elementList=[]}createElementBorder(){this.elementBorder=void 0}getBounds(){return this.elementList[0].getBounds()}setDpeth(e){var t;this.depth=e,this.elementList.forEach((t=>{t.setDepth(e)})),null==(t=this.elementBorder)||t.setDepth(e+2)}receiveBubble(e,t,s,i){if(!this.isFull){for(let h of this.elementList)if(h.isPointInElement(s,i)){h.receiveBubble(e,t,s,i)&&(this.elementFullNb+=1);break}return this.elementFullNb===this.elementList.length&&(this.isFull=!0),this.isFull}return!1}}const mt=He.building,bt=[He.building_fond,He.building_fenetre,He.building_porte];class ft extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of bt)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,mt,this.height,this.width)}}const yt=Ae.arbre,wt=[Ae.elementdroit,Ae.elementgauche,Ae.elementmilieu,Ae.troncD,Ae.troncG];class _t extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of wt)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,yt,this.height,this.width)}}const vt=Ge.building2,kt=[Ge.building2_facade,Ge.building2_fenetre,Ge.building2_porte];class xt extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of kt)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,vt,this.height,this.width)}}const Lt=Ne.buisson,Bt=[Ne.buisson_int];class It extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Bt)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,Lt,this.height,this.width)}}const St=je.buisson2,Tt=[je.buisson2_feuillage];class Mt extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Tt)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,St,this.height,this.width)}}const Pt=ze.vache,Ct=[ze.vache_corps,ze.vache_tache1,ze.vache_tache2,ze.vache_tache3,ze.vache_tache4,ze.vache_tache5];class Ft extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Ct)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,Pt,this.height,this.width)}}const Dt=Ke.chevre,Et=[Ke.chevre_corne,Ke.chevre_corps,Ke.chevre_museau,Ke.chevre_patte,Ke.chevre_tache1,Ke.chevre_tache2,Ke.chevre_tache3];class Ot extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Et)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,Dt,this.height,this.width)}}const Wt=Ue.house,At=[Ue.house_facade,Ue.house_fenetre,Ue.house_mur,Ue.house_porte,Ue.house_toit];class Rt extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of At)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,Wt,this.height,this.width)}}const Ht=Ve.house2,Gt=[Ve.house2_facade,Ve.house2_fenetre,Ve.house2_porte,Ve.house2_toit];class Nt extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Gt)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,Ht,this.height,this.width)}}const jt=$e.house3,Kt=[$e.house3_facade,$e.house3_fenetre,$e.house3_porte,$e.house3_toit];class Ut extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Kt)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,jt,this.height,this.width)}}const Vt=Re.arbre2,$t=[Re.arbre2_feuillage,Re.arbre2_tronc];class zt extends pt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of $t)this.elementList.push(new gt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new gt(this.scene,this.x,this.y,Vt,this.height,this.width)}}const Yt="building",Jt="building2",Xt="bush1",qt="bush2",Qt="cow",Zt="goat",es="house",ts="house2",ss="house3",is="tree",hs="tree2";class as{createDecor(e,t,s,i,h,a){switch(console.debug("key",a),a){case Yt:return new ft(e,t,s,i,h);case Jt:return new xt(e,t,s,i,h);case Xt:return new It(e,t,s,i,h);case qt:return new Mt(e,t,s,i,h);case Qt:return new Ft(e,t,s,i,h);case Zt:return new Ot(e,t,s,i,h);case es:return new Rt(e,t,s,i,h);case ts:return new Nt(e,t,s,i,h);case ss:return new Ut(e,t,s,i,h);case is:return new _t(e,t,s,i,h);case hs:return new zt(e,t,s,i,h);default:return console.debug("in default"),new pt(e,t,s,i,h)}}}class rs{constructor(e,t,s,i,h){R(this,o),R(this,l),R(this,c),R(this,d),R(this,u),R(this,g),R(this,p),R(this,m),R(this,b),O(this,"isBackward"),H(this,l,e),H(this,c,t),H(this,d,s),H(this,b,0),H(this,g,e.scale.width/10),H(this,u,e.scale.height/3),H(this,p,i),H(this,m,h),H(this,o,A(this,l).add.image(t,s,ct)),A(this,o).setScale(A(this,g)/A(this,o).width,A(this,u)/A(this,o).height),A(this,o).setOrigin(.5,1)}switchToHappy(){A(this,l).sound.add(Math.random()>.5?q:Q,{volume:1}).play(),A(this,o).destroy(),H(this,o,A(this,l).add.image(A(this,c),A(this,d),ot)),A(this,o).setScale(A(this,g)/A(this,o).width,A(this,u)/A(this,o).height),A(this,o).setOrigin(.5,1),A(this,o).setDepth(A(this,b))}setDepth(e){H(this,b,e),A(this,o).setDepth(e)}}o=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,g=new WeakMap,p=new WeakMap,m=new WeakMap,b=new WeakMap;const ns=[[is,hs,Xt,qt,Zt,Qt,es],[Yt,Jt,es,ts,ss,is,Xt]],os=new Map;class ls{constructor(e,t,s,i,h){R(this,f),R(this,y),R(this,w),R(this,_),R(this,v),R(this,k),R(this,x),R(this,L),R(this,B),R(this,I),R(this,S),R(this,T),R(this,M),R(this,P),R(this,C),R(this,F),H(this,f,e),H(this,v,A(this,f).scale.height),H(this,_,A(this,f).scale.width),H(this,y,t+A(this,_)/2),H(this,w,s),H(this,k,i),H(this,x,h),H(this,S,0),H(this,I,0),H(this,L,A(this,f).scale.width/5),H(this,B,new as),H(this,T,[]),H(this,P,[]),H(this,C,A(this,f).scale.width/10),H(this,F,!1),os.set(Yt,1),os.set(Jt,1),os.set(Xt,.4),os.set(qt,.4),os.set(Qt,.6),os.set(Zt,.6),os.set(es,.75),os.set(ts,.75),os.set(ss,.75),os.set(is,.75),os.set(hs,.75),this.generateDecorList(),this.generatePNJList(),this.setDepth(A(this,k)),A(this,f).input.on("ColorableArea:receivedBubble",((e,t,s,i)=>{this.receivedBubble(e,100*t,s,i)}))}generatePNJList(){H(this,M,A(this,x).between(1,1));const e=A(this,y)-A(this,_)/2;let t=e;for(let s=0;s<A(this,M);s++){const i=e+A(this,_)-(A(this,M)-s-1)*A(this,C),h=A(this,x).realBetween(t+A(this,C),i),a=A(this,x).realBetween(t+A(this,C)/2,h-A(this,C)/2);A(this,P).push(new rs(A(this,f),a,A(this,w),A(this,y)-A(this,_)/2+A(this,C)/2,A(this,y)+A(this,_)/2-A(this,C)/2)),t=h}}generateDecorList(){H(this,I,A(this,x).between(3,5));const e=ns[A(this,x).between(0,ns.length-1)],t=A(this,y)-A(this,_)/2;let s=t;for(let i=0;i<A(this,I);i++){const h=t+A(this,_)-(A(this,I)-i-1)*A(this,L),a=A(this,x).realBetween(s+A(this,L),h),r=A(this,x).realBetween(A(this,L),a-s),n=A(this,x).realBetween(s+r/2,a-r/2),o=A(this,x).realBetween(A(this,w),A(this,w)-A(this,v)/10),l=A(this,x).realBetween(A(this,f).scale.height/2,o),c=e[A(this,x).between(0,e.length-1)];let d=os.get(c);d||(d=1),A(this,T).push(A(this,B).createDecor(A(this,f),n,o,l*d,r,c)),s=a}}setDepth(e){H(this,k,e),A(this,T).forEach((t=>{t.setDpeth(e)})),A(this,P).forEach((t=>{t.setDepth(e+3)}))}receivedBubble(e,t,s,i){for(let h of A(this,T)){const a=h.getBounds();if(s>=a.left&&s<=a.right&&i>=a.top&&i<=a.bottom){h.receiveBubble(e,t,s,i)&&(H(this,S,A(this,S)+1),A(this,F)||A(this,S)!==A(this,I)||(H(this,F,!0),A(this,P)[0].switchToHappy(),A(this,f).input.emit("Game:victoire")));break}}console.debug("????"),A(this,f).input.emit("Hud:updateProgressBar",this.getAreaScore())}getAreaScore(){return A(this,S)/A(this,I)}}f=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,v=new WeakMap,k=new WeakMap,x=new WeakMap,L=new WeakMap,B=new WeakMap,I=new WeakMap,S=new WeakMap,T=new WeakMap,M=new WeakMap,P=new WeakMap,C=new WeakMap,F=new WeakMap;class cs{constructor(e){O(this,"scene"),O(this,"backgroundList"),this.scene=e,this.backgroundList=[];const t=new N.Geom.Rectangle(0,0,this.scene.scale.width,this.scene.scale.height);let s=0;for(const i of[it,st,tt,et,nt]){const e=this.scene.add.tileSprite(t.centerX,t.height,t.width,0,i).setOrigin(.5,1).setDepth(++s-1e6);this.backgroundList.push(e)}}update(e){let t=e;for(const s of this.backgroundList)s.tilePositionX+=t,t*=4}}class ds extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),O(this,"playerHandBackImage"),O(this,"playerHandFrontImage"),O(this,"sarbapailleImage"),O(this,"currentBubbleTea",null),O(this,"shotCounter",0),O(this,"shotPower",1),O(this,"longPressTimer",null),O(this,"shotColor",16777215),this.playerCharacter=i;const h=this.scene.textures.get(Me).get();this.playerHandBackImage=this.scene.add.image(0,0,Me),this.sarbapailleImage=this.scene.add.image(-.999*h.width,.0799*h.height,Oe).setOrigin(0,.5),this.sarbapailleImage.setRotation(Phaser.Math.DegToRad(-10)),this.playerHandFrontImage=this.scene.add.image(-.1*h.width,-.2*h.height,Pe),this.scene.input.on("PlayerLeftHand:sarbapailleImage:tint",(e=>{this.shotCounter?e.shakeMeAnimation():e.drink()?(this.shotCounter=5,this.currentBubbleTea=e,this.shotColor=this.currentBubbleTea.getColor(),this.updateGauge()):this.updateGauge(!0)})),this.scene.input.on("pointerdown",(()=>{this.longPressureMorePower()})),this.scene.input.on("pointerup",(e=>this.onPointerUp(e))),this.add([this.playerHandBackImage,this.sarbapailleImage,this.playerHandFrontImage]),this.scene.add.existing(this)}longPressureMorePower(){this.longPressTimer=this.scene.time.addEvent({delay:500,callback:()=>{this.shotPower++,this.shotCounter<this.shotPower?this.shotPower=this.shotCounter:this.longPressureMorePower()}})}onPointerUp(e){this.longPressTimer&&(this.longPressTimer.remove(),this.longPressTimer=null);const t=this.scene.cameras.main.getWorldPoint(e.x,e.y),s=this.sarbapailleImage.getWorldTransformMatrix(),i=s.tx,h=s.ty;{if(!this.currentBubbleTea||this.shotCounter<=0)return this.scene.sound.add(ie,{volume:1}).play(),void this.updateGauge(!0);this.shotCounter-=this.shotPower,this.updateGauge();const e=this.shotPower;this.shotPower=1,this.scene.sound.add(se,{volume:1}).play();const s=this.scene.add.circle(i,h,5,this.shotColor).setDepth(1),a=Phaser.Math.Distance.Between(i,h,t.x,t.y),r=Phaser.Math.Clamp(2*a,300,1e3),n=this.shotColor;this.scene.tweens.add({targets:s,scale:2*e,x:t.x,y:t.y,duration:r,ease:"Cubic.easeOut",onComplete:()=>{this.scene.sound.add(he,{volume:1}).play(),this.scene.input.emit("ColorableArea:receivedBubble",n,e,t.x,t.y),s.destroy()}})}}updateGauge(e=!1){e&&(this.currentBubbleTea=null,this.shotColor=16777215,this.shotCounter=0,this.shotPower=1);const t=this.shotCounter>0?this.shotColor:16777215,s=this.shotCounter>3?this.shotColor:16777215,i=this.shotCounter>1?this.shotColor:16777215,h=this.shotCounter>2?this.shotColor:16777215;this.sarbapailleImage.setTint(t,s,i,h)}}class us extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),O(this,"playerArmBackImage"),O(this,"playerLeftHand"),this.playerCharacter=i;const h=this.scene.textures.get(Te).get();this.playerArmBackImage=this.scene.add.image(-.1499*h.width,.2*h.height,Te).setOrigin(0,1),this.playerLeftHand=new ds(this.scene,.73*h.width,-.6399*h.height,this.playerCharacter),this.scene.input.on("pointermove",(e=>{const t=this.scene.cameras.main.getWorldPoint(e.x,e.y),s=this.playerLeftHand.getWorldTransformMatrix(),i=s.tx,h=s.ty;if(t.x>i+.1*this.scene.scale.width){const e=Phaser.Math.Angle.Between(i,h,t.x,t.y);this.playerLeftHand.setRotation(e+Phaser.Math.DegToRad(10))}})),this.add([this.playerArmBackImage,this.playerLeftHand]),this.scene.add.existing(this)}}class gs extends Phaser.GameObjects.Container{constructor(e,t,s){super(e,t,s),O(this,"playerLeftArm"),O(this,"bikeArmImage"),O(this,"bikeWheelImageLeft"),O(this,"bikeWheelImageRight"),O(this,"playerImage"),O(this,"playerLegLeftDownImage"),O(this,"playerLegLeftUpImage"),O(this,"playerLegRightDownImage"),O(this,"playerLegRightUpImage");const i=this.scene.textures.get(Se).get(),h=this.scene.textures.get(Ie).get();this.playerLeftArm=new us(this.scene,.32*i.width,-.69*i.height,this),this.playerLegLeftDownImage=this.scene.add.image(.37*i.width,-.32*i.height,Ce).setVisible(!1),this.playerLegLeftUpImage=this.scene.add.image(.362*i.width,-.406*i.height,Fe),this.bikeWheelImageLeft=this.scene.add.image(h.width/2,-h.width/2,Ie),this.playerImage=this.scene.add.image(.143999*i.width,.093*-i.height,Se).setOrigin(0,1),this.bikeWheelImageRight=this.scene.add.image(0,0,Ie).setScale(.86),this.bikeWheelImageRight.setPosition(.92599*i.width,.14299*-i.height),this.bikeArmImage=this.scene.add.image(.68699*i.width,.247*-i.height,Be),this.playerLegRightDownImage=this.scene.add.image(.37*i.width,-.3*i.height,De),this.playerLegRightUpImage=this.scene.add.image(.38*i.width,-.35*i.height,Ee).setVisible(!1),this.scene.tweens.add({targets:this.bikeWheelImageLeft,angle:360,duration:2e3,ease:"Linear",repeat:-1}),this.scene.tweens.add({targets:this.bikeWheelImageRight,angle:{from:-180,to:180},duration:2e3,ease:"Linear",repeat:-1}),this.scene.time.addEvent({delay:500,loop:!0,callback:()=>{this.playerLegLeftDownImage.setVisible(!this.playerLegLeftDownImage.visible),this.playerLegLeftUpImage.setVisible(!this.playerLegLeftUpImage.visible),this.playerLegRightUpImage.setVisible(!this.playerLegRightUpImage.visible),this.playerLegRightDownImage.setVisible(!this.playerLegRightDownImage.visible)}}),this.scene.input.on("pointermove",(e=>{const t=this.scene.cameras.main.getWorldPoint(e.x,e.y);this.playerLeftArm.setY(-.69*i.height);const s=this.playerLeftArm.getWorldTransformMatrix(),h=s.tx,a=s.ty,r=Phaser.Math.Angle.Between(h,a,t.x,t.y),n=Phaser.Math.Clamp(Phaser.Math.RadToDeg(r),0,30),o=this.scene.scale.height,l=e.y/o,c=this.playerImage.getBounds().height,d=Phaser.Math.Interpolation.Linear([this.playerLeftArm.y-.1*c,this.playerLeftArm.y+.1*c],l);this.playerLeftArm.setRotation(Phaser.Math.DegToRad(n)),this.playerLeftArm.setY(d)})),this.add([this.playerLeftArm,this.playerLegLeftDownImage,this.playerLegLeftUpImage,this.bikeWheelImageLeft,this.playerImage,this.bikeWheelImageRight,this.bikeArmImage,this.playerLegRightDownImage,this.playerLegRightUpImage]),this.scene.add.existing(this)}getPlayerImageBounds(){return this.playerImage.getBounds()}setHeight(e){this.setScale(e/this.getBounds().height)}}function ps(e){return parseInt(e.replace("#",""),16)}const ms=[ps("#009d00"),ps("#00f7ff"),ps("#0028ff"),ps("#17ff00"),ps("#5e208a"),ps("#bf00ff"),ps("#ffdd00"),ps("#ff0000")];class bs{static h2n(e){return ps(e)}static getRandomColor(){return ms[Math.floor(Math.random()*ms.length)]}}class fs{constructor(e,t,s,i){O(this,"teaImage"),O(this,"maskImage"),O(this,"teaMask"),O(this,"cupImage"),O(this,"coverImage"),O(this,"color",16777215),O(this,"drinkLevel",1),this.scene=e,this.x=t,this.y=s,this.bubbleTeaStock=i,this.teaImage=this.scene.add.image(0,0,_e).setOrigin(.5,1),this.cupImage=this.scene.add.image(0,0,ve).setOrigin(.5,1),this.coverImage=this.scene.add.image(0,0,ke).setOrigin(.5,.5),this.coverImage.setAlpha(this.bubbleTeaStock?0:1),this.maskImage=this.scene.make.image({x:0,y:0,key:Le,add:!1}).setOrigin(.5,1),this.teaMask=this.maskImage.createBitmapMask(),this.teaImage.setMask(this.teaMask),i&&this.cupImage.setInteractive(this.scene.input.makePixelPerfect()).on("pointerup",(()=>{this.scene.input.emit("PlayerLeftHand:sarbapailleImage:tint",this)})),this.move(t,s),this.setTint(bs.getRandomColor())}shakeMeAnimation(){const e=this.x,t=this.y,s=.1*this.teaImage.getBounds().width,i=s/2;this.scene.tweens.addCounter({from:0,to:100,duration:50,repeat:5,yoyo:!0,ease:"Linear",onUpdate:h=>{const a=h.getValue()/100,r=e+(a*s-i),n=t;this.move(r,n)},onComplete:()=>{const s=e,i=t;this.move(s,i)}})}hasCover(){return!(this.bubbleTeaStock instanceof fs)}getColor(){return this.color}getDrinkLevel(){return this.drinkLevel}drink(){if(this.drinkLevel<=0)return!1;this.scene.sound.add(te,{volume:1}).play();const e=Math.max(0,this.drinkLevel-.5);return this.scene.tweens.add({targets:this.teaImage,y:this.y+(1-e)*this.teaImage.displayHeight,duration:300,onComplete:()=>{this.drinkLevel=e,this.drinkLevel<=0&&this.bubbleTeaStock&&this.scene.time.addEvent({delay:2e3,callback:()=>{this.bubbleTeaStock&&this.setTint(this.bubbleTeaStock.takeMe())}})}}),!0}setDepth(e){this.teaImage.setDepth(e),this.cupImage.setDepth(e+1),this.coverImage.setDepth(e+2)}move(e,t){this.x=e,this.y=t,this.teaImage.setPosition(this.x,this.y+(1-this.drinkLevel)*this.teaImage.displayHeight),this.maskImage.setPosition(this.x,this.y),this.cupImage.setPosition(this.x,this.y),this.coverImage.setPosition(this.x,this.y-this.cupImage.displayHeight)}setHeight(e){this.teaImage.setScale(e/this.teaImage.height),this.maskImage.setScale(this.teaImage.scale),this.cupImage.setScale(this.teaImage.scale),this.coverImage.setScale(this.teaImage.scale),this.coverImage.setPosition(this.x,this.y-this.cupImage.displayHeight)}setTint(e){this.color=e,this.teaImage.setTint(this.color),this.drinkLevel<1&&(this.scene.sound.add(V,{volume:.8}).play(),this.scene.tweens.add({targets:this.teaImage,y:this.y,duration:300,onComplete:()=>{this.drinkLevel=1}}))}takeMe(){const e=this.color;do{this.color=bs.getRandomColor()}while(this.color===e);return this.setTint(this.color),e}}class ys{constructor(e,t,s){O(this,"playerCharacter"),O(this,"bubbleTeaActifList"),O(this,"bubbleTeaStockList"),this.scene=e,this.x=t,this.y=s,this.bubbleTeaActifList=[],this.bubbleTeaStockList=[],this.bubbleTeaStockList.push(new fs(this.scene,0,0,null)),this.bubbleTeaStockList.push(new fs(this.scene,0,0,null)),this.bubbleTeaStockList.push(new fs(this.scene,0,0,null)),this.bubbleTeaActifList.push(new fs(this.scene,0,0,this.bubbleTeaStockList[0])),this.bubbleTeaActifList.push(new fs(this.scene,0,0,this.bubbleTeaStockList[1])),this.bubbleTeaActifList.push(new fs(this.scene,0,0,this.bubbleTeaStockList[2])),this.playerCharacter=new gs(this.scene,this.x+400,this.y),this.move(t,s)}getX(){return this.x}getY(){return this.y}move(e,t){var s,i,h,a,r,n;this.x=e,this.y=t,this.playerCharacter.setPosition(this.x,this.y);const o=this.playerCharacter.getBounds().bottom-this.scene.scale.height;null==(s=this.bubbleTeaStockList[0])||s.move(this.playerCharacter.x+.699*this.playerCharacter.getPlayerImageBounds().width,o+1.91*this.playerCharacter.getPlayerImageBounds().height),null==(i=this.bubbleTeaStockList[1])||i.move(this.playerCharacter.x+.8745*this.playerCharacter.getPlayerImageBounds().width,o+1.91*this.playerCharacter.getPlayerImageBounds().height),null==(h=this.bubbleTeaStockList[2])||h.move(this.playerCharacter.x+1.05*this.playerCharacter.getPlayerImageBounds().width,o+1.91*this.playerCharacter.getPlayerImageBounds().height),null==(a=this.bubbleTeaActifList[0])||a.move(this.playerCharacter.x+.699*this.playerCharacter.getPlayerImageBounds().width,o+1.727*this.playerCharacter.getPlayerImageBounds().height),null==(r=this.bubbleTeaActifList[1])||r.move(this.playerCharacter.x+.8745*this.playerCharacter.getPlayerImageBounds().width,o+1.727*this.playerCharacter.getPlayerImageBounds().height),null==(n=this.bubbleTeaActifList[2])||n.move(this.playerCharacter.x+1.05*this.playerCharacter.getPlayerImageBounds().width,o+1.727*this.playerCharacter.getPlayerImageBounds().height)}setHeight(e){this.playerCharacter.setHeight(e);for(const t of[...this.bubbleTeaActifList,...this.bubbleTeaStockList])t.setHeight(.17*e);this.move(this.x,this.y)}}const ws=.05;class _s extends G.Scene{constructor(){super("Game"),O(this,"rng"),O(this,"music"),O(this,"parallax"),O(this,"areaTest"),O(this,"startTime"),O(this,"speed"),O(this,"speedLastSlower"),O(this,"endGame",!1),this.rng=new K,this.speed=ws,this.speedLastSlower=0,this.startTime=0}create(){var e;this.endGame=!1,this.speed=ws,this.speedLastSlower=this.time.now,this.scene.launch("Hud"),this.parallax=new cs(this);const t=this.sound.add(ge,{loop:!0,volume:.5}),s=this.sound.add(ne,{loop:!0,volume:1});t.play(),s.play(),this.events.once("shutdown",(()=>{t.stop(),s.stop()}));const i=this.textures.get(nt).get().height;new ys(this,.1*this.scale.width,this.scale.height-i/4).setHeight(.5*this.scale.height),this.areaTest=new ls(this,1e-4*this.scale.width,.95*this.scale.height,-10,this.rng),this.input.on("Hud:updateProgressBar",(e=>{const t=this.scene.get("Hud");t&&t.updateProgressToVictory(e),e>=.99&&(this.endGame||(this.endGame=!0,setTimeout((()=>this.gameOver(Math.floor((Date.now()-this.startTime)/1e3))),1e3)))}));let h=0;null==(e=this.input.keyboard)||e.on("keyup",(e=>{if("Space"===e.code){h+3e3<Date.now()&&(h=Date.now(),this.sound.add(oe,{volume:1}).play());const e=this.speed,t=Math.min(.5,1.5*this.speed);this.tweens.addCounter({from:0,to:100,duration:300,ease:"Linear",onUpdate:s=>{const i=s.getValue()/100;this.speed=e+i*(t-e)}})}})),this.startTime=Date.now()}update(e){this.speed>ws&&e-this.speedLastSlower>100&&(this.speed=Math.max(ws,.9*this.speed),this.speedLastSlower=e),this.parallax.update(this.speed)}gameOver(e){this.scene.stop("Hud"),this.scene.start("GameOver",{timer:e})}}class vs extends G.Scene{constructor(){super("GameOver"),O(this,"camera"),O(this,"background"),O(this,"gameover_text"),O(this,"timer",0)}init(e){this.timer=(null==e?void 0:e.timer)||0}create(){this.add.image(this.scale.width/2,this.scale.height/2,"bg_end");const e=this.sound.add(ce,{loop:!0,volume:.5});e.play(),this.events.once("shutdown",(()=>{e.stop()}));const t=Math.floor(this.timer/60),s=this.timer%60,i=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;this.gameover_text=this.add.text(this.scale.width/2,this.scale.height/2,"You Win !\n"+i,{fontFamily:U,fontSize:100,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5),setTimeout((()=>{this.input.once("pointerup",(()=>{this.scene.start("Leaderboard",{timer:this.timer})}))}),2e3)}}class ks extends G.GameObjects.Container{constructor(e,t,s,i,h){super(e,t,s,h),O(this,"buttonNineSlice"),O(this,"textButton"),this.textButton=this.scene.add.text(0,0,i,{fontFamily:U,fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.textButton.setOrigin(.5);const a=this.textButton.displayWidth+this.scene.scale.width/20*2;this.buttonNineSlice=this.scene.make.nineslice({x:0,y:0,key:pe,leftWidth:250,rightWidth:250,add:!1}).setOrigin(.5),this.buttonNineSlice.setSize(4*a,0).setScale(1.5*this.textButton.displayHeight/this.buttonNineSlice.displayHeight),this.add([this.buttonNineSlice,this.textButton]),this.buttonNineSlice.setInteractive({pixelPerfect:!0,useHandCursor:!0}),this.buttonNineSlice.on("pointerover",(()=>{this.scene.sound.add($,{volume:1}).play()})),this.scene.add.existing(this)}onClickButton(e,t){this.buttonNineSlice.on(e,(()=>{this.scene.sound.add(z,{volume:.5}).play(),t()}))}}class xs extends G.Scene{constructor(){super("MainMenu"),O(this,"background"),O(this,"music")}create(){this.add.image(this.scale.width/2,this.scale.height/2,"background"),this.music=this.sound.add(de,{loop:!0,volume:.25}),this.music.play();const e=new ks(this,this.scale.width/3,.8*this.scale.height,"Play",[]),t=new ks(this,2*this.scale.width/3,.8*this.scale.height,"Scores",[]),s=new ks(this,.9*this.scale.width,.95*this.scale.height,"Credits",[]).setScale(.6);e.setDepth(1),t.setDepth(1),s.setDepth(1),this.events.once("shutdown",(()=>{this.music.stop()})),e.onClickButton("pointerup",(()=>{this.scene.start("Game")})),t.onClickButton("pointerup",(()=>{this.scene.start("Leaderboard",{timer:null})})),s.onClickButton("pointerup",(()=>{this.scene.start("Credits")}))}}class Ls extends G.Scene{constructor(){super("Leaderboard"),O(this,"music"),O(this,"width"),O(this,"height"),O(this,"timer",0),O(this,"bestScoreText")}init(e){console.debug(e),this.timer=(null==e?void 0:e.timer)||0}create(){this.add.image(this.scale.width/2,this.scale.height/2,"bg_end"),this.width=this.scale.width,this.height=this.scale.height,this.music=this.sound.add(ue,{loop:!0,volume:.3}),this.music.play(),this.bestScoreText=this.add.text(this.scale.width/2,this.scale.height/4,"You're in the top 10 !",{fontFamily:U,fontSize:100,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.bestScoreText.setOrigin(.5),this.bestScoreText.setVisible(!1),this.events.once("shutdown",(()=>{this.music.stop()})),this.timer&&this.isInTop10(this.timer)?this.promptForName():this.displayLeaderboard()}displayLeaderboard(){new ks(this,this.width/2,9*this.height/10,"main menu",[]).setScale(.8).onClickButton("pointerup",(()=>{this.scene.start("MainMenu")}));const e=this.loadScores(),t=this.add.text(this.width/2,this.height/10,"Leaderboard",{fontFamily:U,fontSize:100,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5,0);this.add.existing(t);let s=1.2*t.getBounds().bottom;e.forEach(((e,t)=>{const i=this.add.text(this.width/2,s,`${t+1}. ${e.name} - ${this.formatTime(e.timeInSec)}`,{fontFamily:U,fontSize:35,color:"#ffffff",stroke:"#000000",strokeThickness:8}).setOrigin(.5,0);s+=1.2*i.getBounds().height,this.add.existing(i)}))}loadScores(){const e=localStorage.getItem("leaderboard");return e?JSON.parse(e):[]}saveScore(e){const t=this.loadScores();(t.length<10||this.timer<t[t.length-1].timeInSec)&&(t.push({name:e,timeInSec:this.timer}),t.sort(((e,t)=>e.timeInSec-t.timeInSec)),t.length>10&&t.pop(),localStorage.setItem("leaderboard",JSON.stringify(t))),this.displayLeaderboard()}formatTime(e){const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s<10?"0"+s:s}`}isInTop10(e){const t=this.loadScores();return t.length<10||e<t[t.length-1].timeInSec}promptForName(){var e;this.bestScoreText.setVisible(!0),this.sound.add(Y,{volume:1}).play();const t=document.createElement("div");t.id="centered-block",t.innerHTML=`\n      <div style="\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100vh;\n        width: 100vw;\n        position: fixed;\n        top: 0;\n        left: 0;\n      ">\n        <input id="centered-input" type="text" style="\n          padding: 10px;\n          font-size: 32px;\n          font-family: ${U};\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          outline: none;\n        " placeholder="Your name...">\n      </div>\n    `,document.body.appendChild(t),setTimeout((()=>{var e;return null==(e=document.getElementById("centered-input"))?void 0:e.focus()}),300);const s=new ks(this,this.scale.width/2,.75*this.scale.height,"Submit",[]);s.onClickButton("pointerup",(()=>{this.submitForm(s)})),null==(e=this.input.keyboard)||e.on("keyup",(e=>{"Enter"===e.code&&this.submitForm(s)}))}submitForm(e){const t=document.getElementById("centered-input"),s=(t?t.value.trim():null)||"Player",i=document.getElementById("centered-block");i&&i.remove(),e.setVisible(!1),this.bestScoreText.setVisible(!1),this.saveScore(s)}}class Bs extends G.Scene{constructor(){super("Credits"),O(this,"music"),O(this,"creditsData"),this.creditsData=[{name:"Jonathan BURON",role:"Lead & developer",color:"#FF0000"},{name:"Lucie BURON",role:"Graphic artist",color:"#FFFF00"},{name:"Margaux RIANT",role:"Developer",color:"#00FF00"},{name:"Mathis VALERIO",role:"Sound designer & Compositor",color:"#0000FF"},{name:"Melody MORTIER",role:"Graphic & Communication",color:"#4B0082"},{name:"Romuald LE CORROLLER",role:"Developer",color:"#8B00FF"},{name:"Simone BURON",role:"Happiness manager",color:"#FF7F00"},{name:"Valentin FOLASTRE",role:"Developer",color:"#FF0000"}]}create(){this.add.image(this.scale.width/2,this.scale.height/2,"bg_end");const e=this.scale.width,t=this.scale.height;this.music=this.sound.add(ce,{loop:!0,volume:.5}),this.music.play(),this.creditsData.map(((e,s)=>{const i=`${e.name} - ${e.role}`,h=this.add.text(this.scale.width/2,0,i,{fontFamily:U,fontSize:25,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}),a=9*t/100;h.setY(s*a+50)})),this.events.once("shutdown",(()=>{this.music.stop()})),new ks(this,e/2,.9*this.scale.height,"main menu",[]).setScale(.8).onClickButton("pointerup",(()=>{this.scene.start("MainMenu")}))}}const Is=[{color:bs.h2n("#E32332"),asset:Ye},{color:bs.h2n("#8e17eb"),asset:Je},{color:bs.h2n("#2fe640"),asset:Xe},{color:bs.h2n("#f8db1b"),asset:qe},{color:bs.h2n("#f649a8"),asset:Qe}];class Ss extends G.Scene{constructor(){super({key:"Hud",active:!1}),O(this,"timerText"),O(this,"progressBar"),O(this,"progressBarBackground"),O(this,"timerBackground"),O(this,"startTime",0),O(this,"progress",0)}create(){this.timerBackground=this.add.sprite(.1*this.scale.width,.1*this.scale.height,Ze),this.timerBackground.setScale(this.scale.height/6/this.timerBackground.displayHeight),this.timerBackground.setOrigin(.5,.5);const e=this.timerBackground.getBounds();this.timerText=this.add.text(e.centerX,e.centerY,"00:00",{fontFamily:U,fontSize:80,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.timerText.setOrigin(.5,.5).setScale(e.height/this.timerText.displayHeight*.4),this.progressBar=this.add.graphics(),this.progressBarBackground=this.add.sprite(.85*this.scale.width,.1*this.scale.height,Is[0].asset),this.progressBarBackground.setScale(.4),this.progressBarBackground.setOrigin(.5),this.startTime=Date.now(),this.progress=0,this.updateProgressBar()}update(e){const t=Math.floor((Date.now()-this.startTime)/1e3),s=t%60,i=`${Math.floor(t/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;this.timerText.setText(i)}updateProgressBar(){this.progressBar.clear();const e=Math.floor(this.progress*(Is.length-1)),t=Is[e];if(this.progressBarBackground.setTexture(t.asset),this.progress>0){const e=this.progressBarBackground.getBounds();this.progressBar.fillStyle(t.color,1),this.progressBar.fillRoundedRect(e.left+.25*e.width,e.top+.4*e.height,.6*e.width*this.progress,.2*e.height,10)}}updateProgressToVictory(e){this.progress=Phaser.Math.Clamp(e,.1,1),this.updateProgressBar()}}const Ts=[{texture:me,text:"Our story begins in a bleak, monochrome world where happiness is nothing but a distant memory...",duration:1e4},{texture:be,text:"One day, our protagonist accidentally invents something extraordinary: a new magic beverage.",duration:5e3},{texture:fe,text:"One day, our protagonist accidentally invents something extraordinary: a new magic beverage.",duration:5e3},{texture:ye,text:"They name this delightful drink bubble tea and with it comes something extraordinary: color!",duration:1e4},{texture:we,text:"Overwhelmed with excitement, our hero dashes into the streets, eager to share their discovery with the entire town.",duration:1e4}];class Ms extends G.Scene{constructor(){super("Intro"),O(this,"currentSlideIndex",0),O(this,"isTransitioning",!1),O(this,"backgroundMusic",null),O(this,"musicStarted",!1)}create(){var e;this.backgroundMusic=this.sound.add(le,{loop:!0,volume:.5}),this.events.once("shutdown",(()=>{var e;null==(e=this.backgroundMusic)||e.stop()})),this.showSlide(),this.input.on("pointerdown",this.startMusic,this),null==(e=this.input.keyboard)||e.on("keyup",this.startMusic,this)}startMusic(){if(!this.musicStarted&&this.backgroundMusic)return this.backgroundMusic.play(),void(this.musicStarted=!0);this.nextSlide()}showSlide(){const e=Ts[this.currentSlideIndex];this.add.image(0,0,e.texture).setOrigin(0).setDisplaySize(this.scale.width,this.scale.height);const t=this.scale.height/6;this.add.rectangle(0,this.scale.height-t,this.scale.width,t,0,.5).setOrigin(0),this.add.text(this.scale.width/2,this.scale.height-t/2,e.text,{fontFamily:U,fontSize:40,color:"#FFFFFF",wordWrap:{width:this.scale.width-20}}).setOrigin(.5),this.isTransitioning=!1,this.time.delayedCall(e.duration,(()=>{this.isTransitioning||this.nextSlide()}))}nextSlide(){this.isTransitioning||(this.isTransitioning=!0,this.children.removeAll(),this.currentSlideIndex++,this.currentSlideIndex<Ts.length?this.showSlide():this.scene.start("MainMenu"))}}const Ps={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"game-container",backgroundColor:"#151515",dom:{createContainer:!0},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[j,ut,Ms,xs,_s,Ss,vs,Ls,Bs]};new G.Game(Ps);
