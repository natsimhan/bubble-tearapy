var e,t,s,i,h,r,a,n,o,l,c,d,u,g,p,m,b,f,w,y,_,x,v,k,L,B,I,S,T,C,M,P,F,W=Object.defineProperty,D=e=>{throw TypeError(e)},A=(e,t,s)=>((e,t,s)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s),O=(e,t,s)=>t.has(e)||D("Cannot "+s),E=(e,t,s)=>(O(e,t,"read from private field"),s?s.call(e):t.get(e)),R=(e,t,s)=>t.has(e)?D("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),H=(e,t,s,i)=>(O(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s);import{p as G,P as N}from"./phaser-t39vChBe.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class j extends G.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg_start.jpg")}create(){this.scene.start("Preloader")}}class K{constructor(e=""){A(this,"seed"),A(this,"rng"),e||(e=this.generateRandomSeedHash()),this.seed=e,console.debug(this.seed),this.rng=new G.Math.RandomDataGenerator([e])}getSeed(){return this.seed}rollADice(e=20){return this.between(1,e)}random(){return this.rng.realInRange(0,1)}between(e,t){return this.rng.integerInRange(e,t)}realBetween(e,t){return this.rng.realInRange(e,t)}generateRandomSeedHash(e=10){const t=crypto.getRandomValues(new Uint8Array(e));return Array.from(t).map((e=>("0"+e.toString(16)).slice(-2))).join("").slice(0,e)}}const U="DynaPuff, serif",V="remplissage_bubble_tea",X="hover",$="interaction",z="nouveau_record",Y="pnj_confus_1",J="pnj_confus_2",q="pnj_heureux_1",Q="pnj_heureux_2",Z="pnj_triste_1",ee="pnj_triste_2",te="aspiration",se="tir",ie="tir_a_blanc",he="contact_tir",re="sauvetage_pnj_1",ae="sauvetage_pnj_2",ne="velo_normal",oe="velo_rapide",le="cinematic_opening",ce="cinematique_de_fin",de="main_menu",ue="theme_credits",ge="theme_principal",pe="button_blue",me="1",be="2",fe="3",we="4",ye="5",_e="bubbletea",xe="cup",ve="cup_cover",ke="cup_full",Le="cup_mask",Be="bike_arm",Ie="bike_wheel",Se="player",Te="player_arm_back",Ce="player_hand_back",Me="player_hand_front",Pe="player_leg_left_down",Fe="player_leg_left_up",We="player_leg_right_down",De="player_leg_right_up",Ae="sarbapaille",Oe="splash",Ee={arbre:"arbre",elementdroit:"elementdroit",elementgauche:"elementgauche",elementmilieu:"elementmilieu",troncD:"troncD",troncG:"troncG"},Re={arbre2_feuillage:"arbre2_feuillage",arbre2:"arbre2",arbre2_tronc:"arbre2_tronc"},He={building_fenetre:"buiding_fenetre",building_fond:"buiding_fond",building:"buiding",building_porte:"buiding_porte"},Ge={building2_facade:"building2_facade",building2_fenetre:"building2_fenetre",building2:"building2",building2_porte:"building2_porte"},Ne={buisson_int:"buisson_int",buisson:"buisson"},je={buisson2_feuillage:"buisson2_feuillage",buisson2:"buisson2"},Ke={chevre_corne:"chevre_corne",chevre_corps:"chevre_corps",chevre_museau:"chevre_museau",chevre_patte:"chevre_patte",chevre:"chevre",chevre_tache1:"chevre_tache1",chevre_tache2:"chevre_tache2",chevre_tache3:"chevre_tache3"},Ue={house_facade:"house_facade",house_fenetre:"house_fenetre",house_mur:"house_mur",house:"house",house_porte:"house_porte",house_toit:"house_toit"},Ve={house2_facade:"house2_facade",house2_fenetre:"house2_fenetre",house2:"house2",house2_porte:"house2_porte",house2_toit:"house2_toit"},Xe={house3_facade:"house3_facade",house3_fenetre:"house3_fenetre",house3:"house3",house3_porte:"house3_porte",house3_toit:"house3_toit"},$e={vache_corps:"vache_corps",vache:"vache",vache_tache1:"vache_tache1",vache_tache2:"vache_tache2",vache_tache3:"vache_tache3",vache_tache4:"vache_tache4",vache_tache5:"vache_tache5"},ze="background_gauge_0",Ye="background_gauge_1",Je="background_gauge_2",qe="background_gauge_3",Qe="background_gauge_4",Ze="timer_background_pink",et="parallax_bg1",tt="parallax_bg2",st="parallax_bg3",it="parallax_bg4",ht="plant1",rt="plant2",at="plant3",nt="road",ot="pnj_heureux_1",lt="pnj_heureux_2",ct="pnj_triste_1",dt="pnj_triste_2";class ut extends G.Scene{constructor(){super("Preloader")}init(){const e=this.add.image(this.scale.width/2,this.scale.height/2,"background");e.setScale(this.scale.width/e.displayWidth);const t=this.add.rectangle(this.scale.width/2,.9*this.scale.height,.8*this.scale.width,.1*this.scale.height).setOrigin(.5).setStrokeStyle(1,16777215).getBounds(),s=this.add.rectangle(t.left+2,t.top+2,t.width-4,t.height-4,16777215).setOrigin(0);this.add.text(0,0,".",{font:'1px "DynaPuff", serif',color:"#000"}).setAlpha(0),this.load.on("progress",(e=>{s.width=4+(t.width-8)*e}))}preload(){this.load.setPath("assets"),this.load.image("bg_end","bg_end.jpg"),this.preloadAudioEffect(),this.preloadAudioMusic(),this.preloadBubbleTea(),this.preloadDecor(),this.preloadHud(),this.preloadParallaxBackground(),this.preloadPlayer(),this.preloadUi(),this.preloadPNJ(),this.preloadIntro()}create(){this.scene.start("Intro")}preloadPlayer(){this.preloadFromListKey([Be,Ie,Se,Te,Ce,Me,Pe,Fe,We,De,Ae],"player")}preloadBubbleTea(){this.preloadFromListKey([_e,xe,ve,ke,Le],"bubbletea")}preloadUi(){this.preloadFromListKey([pe],"ui")}preloadHud(){this.preloadFromListKey([ze,Ye,Je,qe,Qe,Ze],"hud")}preloadDecor(){this.preloadFromListKey([Oe],"decor"),this.preloadFromListKey([Ee.arbre,Ee.elementdroit,Ee.elementgauche,Ee.elementmilieu,Ee.troncD,Ee.troncG],"decor/arbre"),this.preloadFromListKey([Re.arbre2_feuillage,Re.arbre2,Re.arbre2_tronc],"decor/arbre2"),this.preloadFromListKey([He.building_fenetre,He.building_fond,He.building,He.building_porte],"decor/building"),this.preloadFromListKey([Ge.building2_facade,Ge.building2_fenetre,Ge.building2,Ge.building2_porte],"decor/building2"),this.preloadFromListKey([Ne.buisson_int,Ne.buisson],"decor/buisson1"),this.preloadFromListKey([je.buisson2_feuillage,je.buisson2],"decor/buisson2"),this.preloadFromListKey([Ke.chevre_corne,Ke.chevre_corps,Ke.chevre_museau,Ke.chevre_patte,Ke.chevre,Ke.chevre_tache1,Ke.chevre_tache2,Ke.chevre_tache3],"decor/chevre"),this.preloadFromListKey([Ue.house_facade,Ue.house_fenetre,Ue.house_mur,Ue.house,Ue.house_porte,Ue.house_toit],"decor/house"),this.preloadFromListKey([Ve.house2_facade,Ve.house2_fenetre,Ve.house2,Ve.house2_porte,Ve.house2_toit],"decor/house2"),this.preloadFromListKey([Xe.house3_facade,Xe.house3_fenetre,Xe.house3,Xe.house3_porte,Xe.house3_toit],"decor/house3"),this.preloadFromListKey([$e.vache_corps,$e.vache,$e.vache_tache1,$e.vache_tache2,$e.vache_tache3,$e.vache_tache4,$e.vache_tache5],"decor/vache")}preloadPNJ(){this.preloadFromListKey([ot,lt,ct,dt],"pnj")}preloadIntro(){this.preloadFromListKey([me,be,fe,we,ye],"intro",".jpg")}preloadFromListKey(e,t,s=".png"){for(const i of e)this.load.image(i,`${t}/${i}${s}`)}preloadParallaxBackground(){this.preloadFromListKey([et,tt,st,it,ht,rt,at,nt],"background")}preloadAudioEffect(){this.preloadAudioFromListKey([V,X,$,z,Y,J,q,Q,Z,ee,te,se,ie,he,re,ae,ne,oe],"effects")}preloadAudioMusic(){this.preloadAudioFromListKey([le,ce,de,ue,ge],"musics")}preloadAudioFromListKey(e,t){for(const s of e)this.load.audio(s,`audio/${t}/${s}.ogg`)}}class gt{constructor(e){A(this,"scene"),A(this,"backgroundList"),this.scene=e,this.backgroundList=[];const t=new N.Geom.Rectangle(0,0,this.scene.scale.width,this.scene.scale.height);let s=0;for(const i of[it,st,tt,et,nt]){const e=this.scene.add.tileSprite(t.centerX,t.height,t.width,0,i).setOrigin(.5,1).setDepth(++s-1e6);this.backgroundList.push(e)}this.backgroundList[4].setDepth(0)}update(e){let t=e=e/4/4/4;for(const s of this.backgroundList)s.tilePositionX+=t,t*=4}}class pt extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),A(this,"playerHandBackImage"),A(this,"playerHandFrontImage"),A(this,"sarbapailleImage"),A(this,"currentBubbleTea",null),A(this,"shotCounter",0),A(this,"shotPower",1),A(this,"longPressTimer",null),A(this,"shotColor",16777215),this.playerCharacter=i;const h=this.scene.textures.get(Ce).get();this.playerHandBackImage=this.scene.add.image(0,0,Ce),this.sarbapailleImage=this.scene.add.image(-.999*h.width,.0799*h.height,Ae).setOrigin(0,.5),this.sarbapailleImage.setRotation(Phaser.Math.DegToRad(-10)),this.playerHandFrontImage=this.scene.add.image(-.1*h.width,-.2*h.height,Me),this.scene.input.on("PlayerLeftHand:sarbapailleImage:tint",(e=>{this.shotCounter?e.shakeMeAnimation():e.drink()?(this.shotCounter=5,this.currentBubbleTea=e,this.shotColor=this.currentBubbleTea.getColor(),this.updateGauge()):this.updateGauge(!0)})),this.scene.input.on("pointerdown",(()=>{this.longPressureMorePower()})),this.scene.input.on("pointerup",(e=>this.onPointerUp(e))),this.add([this.playerHandBackImage,this.sarbapailleImage,this.playerHandFrontImage]),this.scene.add.existing(this)}longPressureMorePower(){this.longPressTimer=this.scene.time.addEvent({delay:500,callback:()=>{this.shotPower++,this.shotCounter<this.shotPower?this.shotPower=this.shotCounter:this.longPressureMorePower()}})}onPointerUp(e){this.longPressTimer&&(this.longPressTimer.remove(),this.longPressTimer=null);const t=this.scene.cameras.main.getWorldPoint(e.x,e.y),s=this.sarbapailleImage.getWorldTransformMatrix(),i=s.tx,h=s.ty;if(t.x>this.playerCharacter.getPlayerImageBounds().right){if(!this.currentBubbleTea||this.shotCounter<=0)return this.scene.sound.add(ie,{volume:1}).play(),void this.updateGauge(!0);this.shotCounter-=this.shotPower,this.updateGauge();const e=this.shotPower;this.shotPower=1,this.scene.sound.add(se,{volume:1}).play();const s=this.scene.add.circle(i,h,5,this.shotColor).setDepth(1),r=Phaser.Math.Distance.Between(i,h,t.x,t.y),a=Phaser.Math.Clamp(2*r,300,1e3),n=this.shotColor;this.scene.tweens.add({targets:s,scale:2*e,x:t.x,y:t.y,duration:a,ease:"Cubic.easeOut",onComplete:()=>{this.scene.sound.add(he,{volume:1}).play(),this.scene.input.emit("ColorableArea:receivedBubble",n,e,t.x,t.y),s.destroy()}})}}updateGauge(e=!1){e&&(this.currentBubbleTea=null,this.shotColor=16777215,this.shotCounter=0,this.shotPower=1);const t=this.shotCounter>0?this.shotColor:16777215,s=this.shotCounter>3?this.shotColor:16777215,i=this.shotCounter>1?this.shotColor:16777215,h=this.shotCounter>2?this.shotColor:16777215;this.sarbapailleImage.setTint(t,s,i,h)}}class mt extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),A(this,"playerArmBackImage"),A(this,"playerLeftHand"),this.playerCharacter=i;const h=this.scene.textures.get(Te).get();this.playerArmBackImage=this.scene.add.image(-.1499*h.width,.2*h.height,Te).setOrigin(0,1),this.playerLeftHand=new pt(this.scene,.73*h.width,-.6399*h.height,this.playerCharacter),this.scene.input.on("pointermove",(e=>{const t=this.scene.cameras.main.getWorldPoint(e.x,e.y),s=this.playerLeftHand.getWorldTransformMatrix(),i=s.tx,h=s.ty;if(t.x>i+.1*this.scene.scale.width){const e=Phaser.Math.Angle.Between(i,h,t.x,t.y);this.playerLeftHand.setRotation(e+Phaser.Math.DegToRad(10))}})),this.add([this.playerArmBackImage,this.playerLeftHand]),this.scene.add.existing(this)}}class bt extends Phaser.GameObjects.Container{constructor(e,t,s){super(e,t,s),A(this,"playerLeftArm"),A(this,"bikeArmImage"),A(this,"bikeWheelImageLeft"),A(this,"bikeWheelImageRight"),A(this,"playerImage"),A(this,"playerLegLeftDownImage"),A(this,"playerLegLeftUpImage"),A(this,"playerLegRightDownImage"),A(this,"playerLegRightUpImage");const i=this.scene.textures.get(Se).get(),h=this.scene.textures.get(Ie).get();this.playerLeftArm=new mt(this.scene,.32*i.width,-.69*i.height,this),this.playerLegLeftDownImage=this.scene.add.image(.37*i.width,-.32*i.height,Pe).setVisible(!1),this.playerLegLeftUpImage=this.scene.add.image(.362*i.width,-.406*i.height,Fe),this.bikeWheelImageLeft=this.scene.add.image(h.width/2,-h.width/2,Ie),this.playerImage=this.scene.add.image(.143999*i.width,.093*-i.height,Se).setOrigin(0,1),this.bikeWheelImageRight=this.scene.add.image(0,0,Ie).setScale(.86),this.bikeWheelImageRight.setPosition(.92599*i.width,.14299*-i.height),this.bikeArmImage=this.scene.add.image(.68699*i.width,.247*-i.height,Be),this.playerLegRightDownImage=this.scene.add.image(.37*i.width,-.3*i.height,We),this.playerLegRightUpImage=this.scene.add.image(.38*i.width,-.35*i.height,De).setVisible(!1),this.scene.tweens.add({targets:this.bikeWheelImageLeft,angle:360,duration:2e3,ease:"Linear",repeat:-1}),this.scene.tweens.add({targets:this.bikeWheelImageRight,angle:{from:-180,to:180},duration:2e3,ease:"Linear",repeat:-1}),this.scene.time.addEvent({delay:500,loop:!0,callback:()=>{this.playerLegLeftDownImage.setVisible(!this.playerLegLeftDownImage.visible),this.playerLegLeftUpImage.setVisible(!this.playerLegLeftUpImage.visible),this.playerLegRightUpImage.setVisible(!this.playerLegRightUpImage.visible),this.playerLegRightDownImage.setVisible(!this.playerLegRightDownImage.visible)}}),this.scene.input.on("pointermove",(e=>{const t=this.scene.cameras.main.getWorldPoint(e.x,e.y);this.playerLeftArm.setY(-.69*i.height);const s=this.playerLeftArm.getWorldTransformMatrix(),h=s.tx,r=s.ty,a=Phaser.Math.Angle.Between(h,r,t.x,t.y),n=Phaser.Math.Clamp(Phaser.Math.RadToDeg(a),0,30),o=this.scene.scale.height,l=e.y/o,c=this.playerImage.getBounds().height,d=Phaser.Math.Interpolation.Linear([this.playerLeftArm.y-.1*c,this.playerLeftArm.y+.1*c],l);this.playerLeftArm.setRotation(Phaser.Math.DegToRad(n)),this.playerLeftArm.setY(d)})),this.add([this.playerLeftArm,this.playerLegLeftDownImage,this.playerLegLeftUpImage,this.bikeWheelImageLeft,this.playerImage,this.bikeWheelImageRight,this.bikeArmImage,this.playerLegRightDownImage,this.playerLegRightUpImage]),this.scene.add.existing(this)}getPlayerImageBounds(){return this.playerImage.getBounds()}setHeight(e){this.setScale(e/this.getBounds().height)}}function ft(e){return parseInt(e.replace("#",""),16)}const wt=[ft("#009d00"),ft("#00f7ff"),ft("#0028ff"),ft("#17ff00"),ft("#5e208a"),ft("#bf00ff"),ft("#ffdd00"),ft("#ff0000")];class yt{static h2n(e){return ft(e)}static getRandomColor(){return wt[Math.floor(Math.random()*wt.length)]}}class _t{constructor(e,t,s,i){A(this,"teaImage"),A(this,"maskImage"),A(this,"teaMask"),A(this,"cupImage"),A(this,"coverImage"),A(this,"color",16777215),A(this,"drinkLevel",1),this.scene=e,this.x=t,this.y=s,this.bubbleTeaStock=i,this.teaImage=this.scene.add.image(0,0,_e).setOrigin(.5,1),this.cupImage=this.scene.add.image(0,0,xe).setOrigin(.5,1),this.coverImage=this.scene.add.image(0,0,ve).setOrigin(.5,.5),this.coverImage.setAlpha(this.bubbleTeaStock?0:1),this.maskImage=this.scene.make.image({x:0,y:0,key:Le,add:!1}).setOrigin(.5,1),this.teaMask=this.maskImage.createBitmapMask(),this.teaImage.setMask(this.teaMask),i&&this.cupImage.setInteractive(this.scene.input.makePixelPerfect()).on("pointerup",(()=>{this.scene.input.emit("PlayerLeftHand:sarbapailleImage:tint",this)})),this.move(t,s),this.setTint(yt.getRandomColor())}shakeMeAnimation(){const e=this.x,t=this.y,s=.1*this.teaImage.getBounds().width,i=s/2;this.scene.tweens.addCounter({from:0,to:100,duration:50,repeat:5,yoyo:!0,ease:"Linear",onUpdate:h=>{const r=h.getValue()/100,a=e+(r*s-i),n=t;this.move(a,n)},onComplete:()=>{const s=e,i=t;this.move(s,i)}})}hasCover(){return!(this.bubbleTeaStock instanceof _t)}getColor(){return this.color}getDrinkLevel(){return this.drinkLevel}drink(){if(this.drinkLevel<=0)return!1;this.scene.sound.add(te,{volume:1}).play();const e=Math.max(0,this.drinkLevel-.5);return this.scene.tweens.add({targets:this.teaImage,y:this.y+(1-e)*this.teaImage.displayHeight,duration:300,onComplete:()=>{this.drinkLevel=e,this.drinkLevel<=0&&this.bubbleTeaStock&&this.scene.time.addEvent({delay:2e3,callback:()=>{this.bubbleTeaStock&&this.setTint(this.bubbleTeaStock.takeMe())}})}}),!0}setDepth(e){this.teaImage.setDepth(e),this.cupImage.setDepth(e+1),this.coverImage.setDepth(e+2)}move(e,t){this.x=e,this.y=t,this.teaImage.setPosition(this.x,this.y+(1-this.drinkLevel)*this.teaImage.displayHeight),this.maskImage.setPosition(this.x,this.y),this.cupImage.setPosition(this.x,this.y),this.coverImage.setPosition(this.x,this.y-this.cupImage.displayHeight)}setHeight(e){this.teaImage.setScale(e/this.teaImage.height),this.maskImage.setScale(this.teaImage.scale),this.cupImage.setScale(this.teaImage.scale),this.coverImage.setScale(this.teaImage.scale),this.coverImage.setPosition(this.x,this.y-this.cupImage.displayHeight)}setTint(e){this.color=e,this.teaImage.setTint(this.color),this.drinkLevel<1&&(this.scene.sound.add(V,{volume:.8}).play(),this.scene.tweens.add({targets:this.teaImage,y:this.y,duration:300,onComplete:()=>{this.drinkLevel=1}}))}takeMe(){const e=this.color;do{this.color=yt.getRandomColor()}while(this.color===e);return this.setTint(this.color),e}}class xt{constructor(e,t,s){A(this,"playerCharacter"),A(this,"bubbleTeaActifList"),A(this,"bubbleTeaStockList"),this.scene=e,this.x=t,this.y=s,this.bubbleTeaActifList=[],this.bubbleTeaStockList=[],this.bubbleTeaStockList.push(new _t(this.scene,0,0,null)),this.bubbleTeaStockList.push(new _t(this.scene,0,0,null)),this.bubbleTeaStockList.push(new _t(this.scene,0,0,null)),this.bubbleTeaActifList.push(new _t(this.scene,0,0,this.bubbleTeaStockList[0])),this.bubbleTeaActifList.push(new _t(this.scene,0,0,this.bubbleTeaStockList[1])),this.bubbleTeaActifList.push(new _t(this.scene,0,0,this.bubbleTeaStockList[2])),this.playerCharacter=new bt(this.scene,this.x+400,this.y),this.move(t,s)}getX(){return this.x}getY(){return this.y}move(e,t){var s,i,h,r,a,n;this.x=e,this.y=t,this.playerCharacter.setPosition(this.x,this.y);const o=this.playerCharacter.getBounds().bottom-this.scene.scale.height;null==(s=this.bubbleTeaStockList[0])||s.move(this.playerCharacter.x+.699*this.playerCharacter.getPlayerImageBounds().width,o+1.91*this.playerCharacter.getPlayerImageBounds().height),null==(i=this.bubbleTeaStockList[1])||i.move(this.playerCharacter.x+.8745*this.playerCharacter.getPlayerImageBounds().width,o+1.91*this.playerCharacter.getPlayerImageBounds().height),null==(h=this.bubbleTeaStockList[2])||h.move(this.playerCharacter.x+1.05*this.playerCharacter.getPlayerImageBounds().width,o+1.91*this.playerCharacter.getPlayerImageBounds().height),null==(r=this.bubbleTeaActifList[0])||r.move(this.playerCharacter.x+.699*this.playerCharacter.getPlayerImageBounds().width,o+1.727*this.playerCharacter.getPlayerImageBounds().height),null==(a=this.bubbleTeaActifList[1])||a.move(this.playerCharacter.x+.8745*this.playerCharacter.getPlayerImageBounds().width,o+1.727*this.playerCharacter.getPlayerImageBounds().height),null==(n=this.bubbleTeaActifList[2])||n.move(this.playerCharacter.x+1.05*this.playerCharacter.getPlayerImageBounds().width,o+1.727*this.playerCharacter.getPlayerImageBounds().height)}setHeight(e){this.playerCharacter.setHeight(e);for(const t of[...this.bubbleTeaActifList,...this.bubbleTeaStockList])t.setHeight(.17*e);this.move(this.x,this.y)}}class vt extends Phaser.GameObjects.Image{constructor(o,l,c,d,u,g){super(o,l,c,d),R(this,e),R(this,t),R(this,s),R(this,i),R(this,h),R(this,r),R(this,a),R(this,n),H(this,t,g),H(this,e,u),H(this,s,new Map),H(this,i,0),H(this,h,!1),H(this,r,d),H(this,a,[]),H(this,n,0),this.setScale(E(this,t)/this.width,E(this,e)/this.height),this.setOrigin(.5,1),this.scene.add.existing(this),this.computePixelOccupationRatio()}isPointInElement(e,t){const s=(e-this.getBounds().left)/this.getBounds().width*this.texture.get().width,i=(t-this.getBounds().top)/this.getBounds().height*this.texture.get().height;return this.scene.textures.getPixelAlpha(s,i,E(this,r),0)>200}receiveBubble(e,t,i,r){if(!E(this,h)){if(E(this,s).set(e,t*t+this.getCurrentSizeByColor(e)),H(this,h,this.checkElementFull()),E(this,h))return this.removeSplashes(),this.setTint(this.getMaxColor()),!0;{const s=this.scene.add.image(i,r,Oe);s.setScale(t/s.width,t/s.height),s.setTint(e),s.setDepth(this.depth+1),E(this,a).push(s)}}return!1}getChild(){return[this,...E(this,a)]}getCurrentSizeByColor(e){return E(this,s).get(e)||0}checkElementFull(){let e=0;return E(this,s).forEach(((t,s)=>{e+=t})),H(this,i,e),E(this,i)>this.displayWidth*this.displayHeight*E(this,n)}getMaxColor(){let e=0,t=0;return E(this,s).forEach(((s,i)=>{s>e&&(e=s,t=i)})),t}removeSplashes(){E(this,a).forEach((e=>{e.setAlpha(0)}))}computePixelOccupationRatio(){const e=Math.floor(this.texture.get().width/10),t=Math.floor(this.texture.get().height/10);for(let s=0;s<this.texture.get().width;s+=e)for(let e=0;e<this.texture.get().height;e+=t)this.scene.textures.getPixelAlpha(s,e,E(this,r),0)>200&&H(this,n,E(this,n)+.01)}}e=new WeakMap,t=new WeakMap,s=new WeakMap,i=new WeakMap,h=new WeakMap,r=new WeakMap,a=new WeakMap,n=new WeakMap;class kt{constructor(e,t,s,i,h){A(this,"scene"),A(this,"elementList"),A(this,"elementBorder"),A(this,"x"),A(this,"y"),A(this,"height"),A(this,"width"),A(this,"depth"),A(this,"elementFullNb"),A(this,"isFull"),this.scene=e,this.x=t,this.y=s,this.height=i,this.width=h,this.elementFullNb=0,this.isFull=!1,this.createElementList(),this.createElementBorder()}getChild(){return this.elementBorder?[...this.elementList,this.elementBorder]:this.elementList}createElementList(){this.elementList=[]}createElementBorder(){this.elementBorder=void 0}getBounds(){return this.elementList[0].getBounds()}setDpeth(e){var t;this.depth=e,this.elementList.forEach((t=>{t.setDepth(e)})),null==(t=this.elementBorder)||t.setDepth(e+2)}receiveBubble(e,t,s,i){if(!this.isFull){for(let h of this.elementList)if(h.isPointInElement(s,i)){h.receiveBubble(e,t,s,i)&&(this.elementFullNb+=1);break}return this.elementFullNb===this.elementList.length&&(this.isFull=!0),this.isFull}return!1}}const Lt=He.building,Bt=[He.building_fond,He.building_fenetre,He.building_porte];class It extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Bt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,Lt,this.height,this.width)}}const St=Ee.arbre,Tt=[Ee.elementdroit,Ee.elementgauche,Ee.elementmilieu,Ee.troncD,Ee.troncG];class Ct extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Tt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,St,this.height,this.width)}}const Mt=Ge.building2,Pt=[Ge.building2_facade,Ge.building2_fenetre,Ge.building2_porte];class Ft extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Pt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,Mt,this.height,this.width)}}const Wt=Ne.buisson,Dt=[Ne.buisson_int];class At extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Dt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,Wt,this.height,this.width)}}const Ot=je.buisson2,Et=[je.buisson2_feuillage];class Rt extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Et)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,Ot,this.height,this.width)}}const Ht=$e.vache,Gt=[$e.vache_corps,$e.vache_tache1,$e.vache_tache2,$e.vache_tache3,$e.vache_tache4,$e.vache_tache5];class Nt extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Gt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,Ht,this.height,this.width)}}const jt=Ke.chevre,Kt=[Ke.chevre_corne,Ke.chevre_corps,Ke.chevre_museau,Ke.chevre_patte,Ke.chevre_tache1,Ke.chevre_tache2,Ke.chevre_tache3];class Ut extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Kt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,jt,this.height,this.width)}}const Vt=Ue.house,Xt=[Ue.house_facade,Ue.house_fenetre,Ue.house_mur,Ue.house_porte,Ue.house_toit];class $t extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Xt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,Vt,this.height,this.width)}}const zt=Ve.house2,Yt=[Ve.house2_facade,Ve.house2_fenetre,Ve.house2_porte,Ve.house2_toit];class Jt extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Yt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,zt,this.height,this.width)}}const qt=Xe.house3,Qt=[Xe.house3_facade,Xe.house3_fenetre,Xe.house3_porte,Xe.house3_toit];class Zt extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of Qt)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,qt,this.height,this.width)}}const es=Re.arbre2,ts=[Re.arbre2_feuillage,Re.arbre2_tronc];class ss extends kt{constructor(e,t,s,i,h){super(e,t,s,i,h)}createElementList(){this.elementList=[];for(let e of ts)this.elementList.push(new vt(this.scene,this.x,this.y,e,this.height,this.width))}createElementBorder(){this.elementBorder=new vt(this.scene,this.x,this.y,es,this.height,this.width)}}const is="building",hs="building2",rs="bush1",as="bush2",ns="cow",os="goat",ls="house",cs="house2",ds="house3",us="tree",gs="tree2";class ps{createDecor(e,t,s,i,h,r){switch(r){case is:return new It(e,t,s,i,h);case hs:return new Ft(e,t,s,i,h);case rs:return new At(e,t,s,i,h);case as:return new Rt(e,t,s,i,h);case ns:return new Nt(e,t,s,i,h);case os:return new Ut(e,t,s,i,h);case ls:return new $t(e,t,s,i,h);case cs:return new Jt(e,t,s,i,h);case ds:return new Zt(e,t,s,i,h);case us:return new Ct(e,t,s,i,h);case gs:return new ss(e,t,s,i,h);default:return new kt(e,t,s,i,h)}}}class ms{constructor(e,t,s,i,h){R(this,o),R(this,l),R(this,c),R(this,d),R(this,u),R(this,g),R(this,p),R(this,m),R(this,b),A(this,"direction",-1),A(this,"speed",2),A(this,"refX"),H(this,l,e),H(this,c,t),H(this,d,s),H(this,b,0),H(this,g,e.scale.width/10),H(this,u,e.scale.height/3),H(this,p,t-i),H(this,m,h-t),this.refX=t,H(this,o,E(this,l).add.image(t,s,ct)),E(this,o).setScale(E(this,g)/E(this,o).width,E(this,u)/E(this,o).height),E(this,o).setOrigin(.5,1)}switchToHappy(){E(this,l).sound.add(Math.random()>.5?q:Q,{volume:1}).play(),E(this,o).destroy(),H(this,o,E(this,l).add.image(E(this,c),E(this,d),ot)),E(this,o).setScale(E(this,g)/E(this,o).width,E(this,u)/E(this,o).height),E(this,o).setOrigin(.5,1),E(this,o).setDepth(E(this,b))}setDepth(e){H(this,b,e),E(this,o).setDepth(e)}update(e,t){if(E(this,o)&&E(this,o).visible){this.refX+=e,E(this,o).x+=this.speed*(this.direction>0?.25:2)*this.direction;const s=E(this,o).displayWidth+1;E(this,o).x<-s&&(E(this,o).x+=t,this.refX+=t),E(this,o).x>=this.refX+E(this,m)?(E(this,o).x=this.refX+E(this,m),this.direction=-1,E(this,o).setFlipX(!1)):E(this,o).x<=this.refX+E(this,p)&&(E(this,o).x=this.refX+E(this,p),this.direction=1,E(this,o).setFlipX(!0))}}}o=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,g=new WeakMap,p=new WeakMap,m=new WeakMap,b=new WeakMap;const bs=[[us,gs,rs,as,os,ns,ls],[is,hs,ls,cs,ds,us,rs]],fs=new Map;class ws{constructor(e,t,s,i,h){R(this,f),R(this,w),R(this,y),R(this,_),R(this,x),R(this,v),R(this,k),R(this,L),R(this,B),R(this,I),R(this,S),R(this,T),R(this,C),R(this,M),R(this,P),R(this,F),H(this,f,e),H(this,x,E(this,f).scale.height),H(this,_,E(this,f).scale.width),H(this,w,t+E(this,_)/2),H(this,y,s),H(this,v,i),H(this,k,h),H(this,S,0),H(this,I,0),H(this,L,E(this,f).scale.width/5),H(this,B,new ps),H(this,T,[]),H(this,M,[]),H(this,P,E(this,f).scale.width/10),H(this,F,!1),fs.set(is,1),fs.set(hs,1),fs.set(rs,.4),fs.set(as,.4),fs.set(ns,.6),fs.set(os,.6),fs.set(ls,.75),fs.set(cs,.75),fs.set(ds,.75),fs.set(us,.75),fs.set(gs,.75),this.generateDecorList(),this.generatePNJList(),this.setDepth(E(this,v)),E(this,f).input.on("ColorableArea:receivedBubble",((e,t,s,i)=>{this.receivedBubble(e,100*t,s,i)}))}getChild(){return[...E(this,T),...E(this,M)]}generatePNJList(){H(this,C,E(this,k).between(1,1));const e=E(this,w)-E(this,_)/2;let t=e;for(let s=0;s<E(this,C);s++){const i=e+E(this,_)-(E(this,C)-s-1)*E(this,P),h=E(this,k).realBetween(t+E(this,P),i),r=E(this,k).realBetween(t+E(this,P)/2,h-E(this,P)/2);E(this,M).push(new ms(E(this,f),r,E(this,y),E(this,w)-E(this,_)/2+E(this,P)/2,E(this,w)+E(this,_)/2-E(this,P)/2)),t=h}}generateDecorList(){H(this,I,E(this,k).between(3,5));const e=bs[E(this,k).between(0,bs.length-1)],t=E(this,w)-E(this,_)/2;let s=t;for(let i=0;i<E(this,I);i++){const h=t+E(this,_)-(E(this,I)-i-1)*E(this,L),r=E(this,k).realBetween(s+E(this,L),h),a=E(this,k).realBetween(E(this,L),r-s),n=E(this,k).realBetween(s+a/2,r-a/2),o=E(this,k).realBetween(E(this,y),E(this,y)-E(this,x)/10),l=E(this,k).realBetween(E(this,f).scale.height/2,o),c=e[E(this,k).between(0,e.length-1)];let d=fs.get(c);d||(d=1),E(this,T).push(E(this,B).createDecor(E(this,f),n,o,l*d,a,c)),s=r}}setDepth(e){H(this,v,e),E(this,T).forEach((t=>{t.setDpeth(e)})),E(this,M).forEach((t=>{t.setDepth(e+3)}))}receivedBubble(e,t,s,i){for(let h of E(this,T)){const r=h.getBounds();if(s>=r.left&&s<=r.right&&i>=r.top&&i<=r.bottom){h.receiveBubble(e,t,s,i)&&(H(this,S,E(this,S)+1),E(this,F)||E(this,S)!==E(this,I)||(H(this,F,!0),E(this,M)[0].switchToHappy(),E(this,f).input.emit("Game:victoire")));break}}E(this,f).input.emit("Hud:updateProgressBar",this.getAreaScore())}getAreaScore(){return E(this,S)/E(this,I)}}f=new WeakMap,w=new WeakMap,y=new WeakMap,_=new WeakMap,x=new WeakMap,v=new WeakMap,k=new WeakMap,L=new WeakMap,B=new WeakMap,I=new WeakMap,S=new WeakMap,T=new WeakMap,C=new WeakMap,M=new WeakMap,P=new WeakMap,F=new WeakMap;class ys{constructor(e,t,s){A(this,"colorableAreaList"),A(this,"worldWidth"),this.scene=e,this.rng=s,this.colorableAreaList=[];const i=this.rng.between(3,10);this.worldWidth=t;for(let h=0;h<i;h++){const e=new ws(this.scene,this.worldWidth,.95*this.scene.scale.height,-10,this.rng);this.colorableAreaList.push(e),this.worldWidth+=this.scene.scale.width}}update(e){for(const t of this.colorableAreaList)for(const s of t.getChild())if(s instanceof kt)for(const t of s.getChild())for(const s of t.getChild())this.moveImageOnXWithSpeedAndWorldRotation(s,e);else s instanceof ms&&s.update(-e,this.worldWidth)}moveImageOnXWithSpeedAndWorldRotation(e,t){const s=e.x+-t,i=e.displayWidth+1;e.setX(s>-i?s:this.worldWidth-i)}}class _s extends G.Scene{constructor(){super("Game"),A(this,"rng"),A(this,"music"),A(this,"parallax"),A(this,"areaTest"),A(this,"startTime"),A(this,"worldContainer"),A(this,"speed"),A(this,"speedLastSlower"),A(this,"endGame",!1),this.rng=new K,this.speed=2,this.speedLastSlower=0,this.startTime=0}create(){var e;this.endGame=!1,this.speed=2,this.speedLastSlower=this.time.now,this.scene.launch("Hud"),this.parallax=new gt(this);const t=this.sound.add(ge,{loop:!0,volume:.5}),s=this.sound.add(ne,{loop:!0,volume:1});t.play(),s.play(),this.events.once("shutdown",(()=>{t.stop(),s.stop()}));const i=this.textures.get(nt).get().height;new xt(this,.1*this.scale.width,this.scale.height-i/4).setHeight(.5*this.scale.height),this.worldContainer=new ys(this,0,this.rng),this.input.on("Hud:updateProgressBar",(e=>{const t=this.scene.get("Hud");t&&t.updateProgressToVictory(e),e>=.99&&(this.endGame||(this.endGame=!0,setTimeout((()=>this.gameOver(Math.floor((Date.now()-this.startTime)/1e3))),1e3)))}));let h=0;null==(e=this.input.keyboard)||e.on("keyup",(e=>{if("Space"===e.code){h+3e3<Date.now()&&(h=Date.now(),this.sound.add(oe,{volume:1}).play());const e=this.speed,t=Math.min(20,1.5*this.speed);this.tweens.addCounter({from:0,to:100,duration:300,ease:"Linear",onUpdate:s=>{const i=s.getValue()/100;this.speed=e+i*(t-e)}})}})),this.startTime=Date.now()}update(e){this.speed>2&&e-this.speedLastSlower>100&&(this.speed=Math.max(2,.9*this.speed),this.speedLastSlower=e),this.parallax.update(this.speed),this.worldContainer.update(this.speed)}gameOver(e){this.scene.stop("Hud"),this.scene.start("GameOver",{timer:e})}}class xs extends G.Scene{constructor(){super("GameOver"),A(this,"camera"),A(this,"background"),A(this,"gameover_text"),A(this,"timer",0)}init(e){this.timer=(null==e?void 0:e.timer)||0}create(){this.add.image(this.scale.width/2,this.scale.height/2,"bg_end");const e=this.sound.add(ce,{loop:!0,volume:.5});e.play(),this.events.once("shutdown",(()=>{e.stop()}));const t=Math.floor(this.timer/60),s=this.timer%60,i=`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;this.gameover_text=this.add.text(this.scale.width/2,this.scale.height/2,"You Win !\n"+i,{fontFamily:U,fontSize:100,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5),setTimeout((()=>{this.input.once("pointerup",(()=>{this.scene.start("Leaderboard",{timer:this.timer})}))}),2e3)}}class vs extends G.GameObjects.Container{constructor(e,t,s,i,h){super(e,t,s,h),A(this,"buttonNineSlice"),A(this,"textButton"),this.textButton=this.scene.add.text(0,0,i,{fontFamily:U,fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.textButton.setOrigin(.5);const r=this.textButton.displayWidth+this.scene.scale.width/20*2;this.buttonNineSlice=this.scene.make.nineslice({x:0,y:0,key:pe,leftWidth:250,rightWidth:250,add:!1}).setOrigin(.5),this.buttonNineSlice.setSize(4*r,0).setScale(1.5*this.textButton.displayHeight/this.buttonNineSlice.displayHeight),this.add([this.buttonNineSlice,this.textButton]),this.buttonNineSlice.setInteractive({pixelPerfect:!0,useHandCursor:!0}),this.buttonNineSlice.on("pointerover",(()=>{this.scene.sound.add(X,{volume:1}).play()})),this.scene.add.existing(this)}onClickButton(e,t){this.buttonNineSlice.on(e,(()=>{this.scene.sound.add($,{volume:.5}).play(),t()}))}}class ks extends G.Scene{constructor(){super("MainMenu"),A(this,"background"),A(this,"music")}create(){this.add.image(this.scale.width/2,this.scale.height/2,"background"),this.music=this.sound.add(de,{loop:!0,volume:.25}),this.music.play();const e=new vs(this,this.scale.width/3,.8*this.scale.height,"Play",[]),t=new vs(this,2*this.scale.width/3,.8*this.scale.height,"Scores",[]),s=new vs(this,.9*this.scale.width,.95*this.scale.height,"Credits",[]).setScale(.6);e.setDepth(1),t.setDepth(1),s.setDepth(1),this.events.once("shutdown",(()=>{this.music.stop()})),e.onClickButton("pointerup",(()=>{this.scene.start("Game")})),t.onClickButton("pointerup",(()=>{this.scene.start("Leaderboard",{timer:null})})),s.onClickButton("pointerup",(()=>{this.scene.start("Credits")}))}}class Ls extends G.Scene{constructor(){super("Leaderboard"),A(this,"music"),A(this,"width"),A(this,"height"),A(this,"timer",0),A(this,"bestScoreText")}init(e){this.timer=(null==e?void 0:e.timer)||0}create(){this.add.image(this.scale.width/2,this.scale.height/2,"bg_end"),this.width=this.scale.width,this.height=this.scale.height,this.music=this.sound.add(ue,{loop:!0,volume:.3}),this.music.play(),this.bestScoreText=this.add.text(this.scale.width/2,this.scale.height/4,"You're in the top 10 !",{fontFamily:U,fontSize:100,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.bestScoreText.setOrigin(.5),this.bestScoreText.setVisible(!1),this.events.once("shutdown",(()=>{this.music.stop()})),this.timer&&this.isInTop10(this.timer)?this.promptForName():this.displayLeaderboard()}displayLeaderboard(){new vs(this,this.width/2,9*this.height/10,"main menu",[]).setScale(.8).onClickButton("pointerup",(()=>{this.scene.start("MainMenu")}));const e=this.loadScores(),t=this.add.text(this.width/2,this.height/10,"Leaderboard",{fontFamily:U,fontSize:100,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5,0);this.add.existing(t);let s=1.2*t.getBounds().bottom;e.forEach(((e,t)=>{const i=this.add.text(this.width/2,s,`${t+1}. ${e.name} - ${this.formatTime(e.timeInSec)}`,{fontFamily:U,fontSize:35,color:"#ffffff",stroke:"#000000",strokeThickness:8}).setOrigin(.5,0);s+=1.2*i.getBounds().height,this.add.existing(i)}))}loadScores(){const e=localStorage.getItem("leaderboard");return e?JSON.parse(e):[]}saveScore(e){const t=this.loadScores();(t.length<10||this.timer<t[t.length-1].timeInSec)&&(t.push({name:e,timeInSec:this.timer}),t.sort(((e,t)=>e.timeInSec-t.timeInSec)),t.length>10&&t.pop(),localStorage.setItem("leaderboard",JSON.stringify(t))),this.displayLeaderboard()}formatTime(e){const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s<10?"0"+s:s}`}isInTop10(e){const t=this.loadScores();return t.length<10||e<t[t.length-1].timeInSec}promptForName(){var e;this.bestScoreText.setVisible(!0),this.sound.add(z,{volume:1}).play();const t=document.createElement("div");t.id="centered-block",t.innerHTML=`\n      <div style="\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100vh;\n        width: 100vw;\n        position: fixed;\n        top: 0;\n        left: 0;\n      ">\n        <input id="centered-input" type="text" style="\n          padding: 10px;\n          font-size: 32px;\n          font-family: ${U};\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          outline: none;\n        " placeholder="Your name...">\n      </div>\n    `,document.body.appendChild(t),setTimeout((()=>{var e;return null==(e=document.getElementById("centered-input"))?void 0:e.focus()}),300);const s=new vs(this,this.scale.width/2,.75*this.scale.height,"Submit",[]);s.onClickButton("pointerup",(()=>{this.submitForm(s)})),null==(e=this.input.keyboard)||e.on("keyup",(e=>{"Enter"===e.code&&this.submitForm(s)}))}submitForm(e){const t=document.getElementById("centered-input"),s=(t?t.value.trim():null)||"Player",i=document.getElementById("centered-block");i&&i.remove(),e.setVisible(!1),this.bestScoreText.setVisible(!1),this.saveScore(s)}}class Bs extends G.Scene{constructor(){super("Credits"),A(this,"music"),A(this,"creditsData"),this.creditsData=[{name:"Jonathan BURON",role:"Lead & developer",color:"#FF0000"},{name:"Lucie BURON",role:"Graphic artist",color:"#FFFF00"},{name:"Margaux RIANT",role:"Developer",color:"#00FF00"},{name:"Mathis VALERIO",role:"Sound designer & Compositor",color:"#0000FF"},{name:"Melody MORTIER",role:"Graphic & Communication",color:"#4B0082"},{name:"Romuald LE CORROLLER",role:"Developer",color:"#8B00FF"},{name:"Simone BURON",role:"Happiness manager",color:"#FF7F00"},{name:"Valentin FOLASTRE",role:"Developer",color:"#FF0000"}]}create(){this.add.image(this.scale.width/2,this.scale.height/2,"bg_end");const e=this.scale.width,t=this.scale.height;this.music=this.sound.add(ce,{loop:!0,volume:.5}),this.music.play(),this.creditsData.map(((e,s)=>{const i=`${e.name} - ${e.role}`,h=this.add.text(this.scale.width/2,0,i,{fontFamily:U,fontSize:25,color:"#ffffff",stroke:"#000000",strokeThickness:4,align:"center"}),r=9*t/100;h.setY(s*r+50)})),this.events.once("shutdown",(()=>{this.music.stop()})),new vs(this,e/2,.9*this.scale.height,"main menu",[]).setScale(.8).onClickButton("pointerup",(()=>{this.scene.start("MainMenu")}))}}const Is=[{color:yt.h2n("#E32332"),asset:ze},{color:yt.h2n("#8e17eb"),asset:Ye},{color:yt.h2n("#2fe640"),asset:Je},{color:yt.h2n("#f8db1b"),asset:qe},{color:yt.h2n("#f649a8"),asset:Qe}];class Ss extends G.Scene{constructor(){super({key:"Hud",active:!1}),A(this,"timerText"),A(this,"progressBar"),A(this,"progressBarBackground"),A(this,"timerBackground"),A(this,"startTime",0),A(this,"progress",0)}create(){this.timerBackground=this.add.sprite(.1*this.scale.width,.1*this.scale.height,Ze),this.timerBackground.setScale(this.scale.height/6/this.timerBackground.displayHeight),this.timerBackground.setOrigin(.5,.5);const e=this.timerBackground.getBounds();this.timerText=this.add.text(e.centerX,e.centerY,"00:00",{fontFamily:U,fontSize:80,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.timerText.setOrigin(.5,.5).setScale(e.height/this.timerText.displayHeight*.4),this.progressBar=this.add.graphics(),this.progressBarBackground=this.add.sprite(.85*this.scale.width,.1*this.scale.height,Is[0].asset),this.progressBarBackground.setScale(.4),this.progressBarBackground.setOrigin(.5),this.startTime=Date.now(),this.progress=0,this.updateProgressBar()}update(e){const t=Math.floor((Date.now()-this.startTime)/1e3),s=t%60,i=`${Math.floor(t/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;this.timerText.setText(i)}updateProgressBar(){this.progressBar.clear();const e=Math.floor(this.progress*(Is.length-1)),t=Is[e];if(this.progressBarBackground.setTexture(t.asset),this.progress>0){const e=this.progressBarBackground.getBounds();this.progressBar.fillStyle(t.color,1),this.progressBar.fillRoundedRect(e.left+.25*e.width,e.top+.4*e.height,.6*e.width*this.progress,.2*e.height,10)}}updateProgressToVictory(e){this.progress=Phaser.Math.Clamp(e,.1,1),this.updateProgressBar()}}const Ts=[{texture:me,text:"Our story begins in a bleak, monochrome world where happiness is nothing but a distant memory...",duration:1e4},{texture:be,text:"One day, our protagonist accidentally invents something extraordinary: a new magic beverage.",duration:5e3},{texture:fe,text:"One day, our protagonist accidentally invents something extraordinary: a new magic beverage.",duration:5e3},{texture:we,text:"They name this delightful drink bubble tea and with it comes something extraordinary: color!",duration:1e4},{texture:ye,text:"Overwhelmed with excitement, our hero dashes into the streets, eager to share their discovery with the entire town.",duration:1e4}];class Cs extends G.Scene{constructor(){super("Intro"),A(this,"currentSlideIndex",0),A(this,"isTransitioning",!1),A(this,"backgroundMusic",null),A(this,"musicStarted",!1)}create(){var e;this.backgroundMusic=this.sound.add(le,{loop:!0,volume:.5}),this.events.once("shutdown",(()=>{var e;null==(e=this.backgroundMusic)||e.stop()})),this.showSlide(),this.input.on("pointerdown",this.startMusic,this),null==(e=this.input.keyboard)||e.on("keyup",this.startMusic,this)}startMusic(){if(!this.musicStarted&&this.backgroundMusic)return this.backgroundMusic.play(),void(this.musicStarted=!0);this.nextSlide()}showSlide(){const e=Ts[this.currentSlideIndex];this.add.image(0,0,e.texture).setOrigin(0).setDisplaySize(this.scale.width,this.scale.height);const t=this.scale.height/6;this.add.rectangle(0,this.scale.height-t,this.scale.width,t,0,.5).setOrigin(0),this.add.text(this.scale.width/2,this.scale.height-t/2,e.text,{fontFamily:U,fontSize:40,color:"#FFFFFF",wordWrap:{width:this.scale.width-20}}).setOrigin(.5),this.isTransitioning=!1,this.time.delayedCall(e.duration,(()=>{this.isTransitioning||this.nextSlide()}))}nextSlide(){this.isTransitioning||(this.isTransitioning=!0,this.children.removeAll(),this.currentSlideIndex++,this.currentSlideIndex<Ts.length?this.showSlide():this.scene.start("MainMenu"))}}const Ms={type:Phaser.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"game-container",backgroundColor:"#151515",dom:{createContainer:!0},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[j,ut,Cs,ks,_s,Ss,xs,Ls,Bs]};new G.Game(Ms);
